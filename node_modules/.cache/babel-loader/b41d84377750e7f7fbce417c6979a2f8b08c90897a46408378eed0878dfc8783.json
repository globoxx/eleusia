{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/vince/OneDrive/Documents/GitHub/eleusia/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/vince/OneDrive/Documents/GitHub/eleusia/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import*as tf from'@tensorflow/tfjs';var CLASS_NAMES=[\"Refused\",\"Accepted\"];// Put your class names here\nvar MyModel={featureExtractor:null,model:null,loadFeatureExtractor:function(){var _loadFeatureExtractor=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var URL;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:URL='https://tfhub.dev/google/tfjs-model/imagenet/mobilenet_v3_small_100_224/feature_vector/5/default/1';_context.next=3;return tf.loadGraphModel(URL,{fromTFHub:true});case 3:MyModel.featureExtractor=_context.sent;console.log('Feature extractor loaded');case 5:case\"end\":return _context.stop();}},_callee);}));function loadFeatureExtractor(){return _loadFeatureExtractor.apply(this,arguments);}return loadFeatureExtractor;}(),loadModel:function loadModel(){MyModel.model=tf.sequential();MyModel.model.add(tf.layers.dense({inputShape:[1024],units:128,activation:'relu'}));MyModel.model.add(tf.layers.dense({units:CLASS_NAMES.length,activation:'softmax'}));MyModel.model.compile({optimizer:'adam',loss:CLASS_NAMES.length===2?'binaryCrossentropy':'categoricalCrossentropy',metrics:['accuracy']});console.log('Model loaded');},resetModel:function resetModel(){MyModel.loadModel();},preprocessImage:function preprocessImage(image){return tf.tidy(function(){var tensor=tf.browser.fromPixels(image).resizeBilinear([224,224]).div(255.0).expandDims();if(MyModel.featureExtractor){return MyModel.featureExtractor.predict(tensor).squeeze();}throw new Error(\"Feature extractor not loaded\");});},trainModel:function(){var _trainModel=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(images,labels){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",new Promise(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(resolve,reject){var xs,ys;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;xs=tf.stack(images.map(function(image){return MyModel.preprocessImage(image);}));ys=tf.oneHot(tf.tensor1d(labels,'int32'),CLASS_NAMES.length);if(!MyModel.model){_context2.next=10;break;}_context2.next=6;return MyModel.model.fit(xs,ys,{epochs:10,shuffle:true});case 6:console.log('Model trained');resolve();_context2.next=11;break;case 10:reject(new Error(\"Model not loaded\"));case 11:_context2.next=16;break;case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](0);reject(_context2.t0);case 16:_context2.prev=16;if(xs)xs.dispose();if(ys)ys.dispose();return _context2.finish(16);case 20:case\"end\":return _context2.stop();}},_callee2,null,[[0,13,16,20]]);}));return function(_x3,_x4){return _ref.apply(this,arguments);};}()));case 1:case\"end\":return _context3.stop();}},_callee3);}));function trainModel(_x,_x2){return _trainModel.apply(this,arguments);}return trainModel;}(),predictImage:function predictImage(image){return new Promise(function(resolve,reject){var imageFeatures;try{imageFeatures=MyModel.preprocessImage(image);if(MyModel.model){var predictionLabel=MyModel.model.predict(imageFeatures.expandDims()).squeeze().dataSync();resolve(predictionLabel);}else{reject(new Error(\"Model not loaded\"));}}catch(error){reject(error);}finally{if(imageFeatures)imageFeatures.dispose();}});}};export default MyModel;","map":{"version":3,"names":["tf","CLASS_NAMES","MyModel","featureExtractor","model","loadFeatureExtractor","_loadFeatureExtractor","_asyncToGenerator","_regeneratorRuntime","mark","_callee","URL","wrap","_callee$","_context","prev","next","loadGraphModel","fromTFHub","sent","console","log","stop","apply","arguments","loadModel","sequential","add","layers","dense","inputShape","units","activation","length","compile","optimizer","loss","metrics","resetModel","preprocessImage","image","tidy","tensor","browser","fromPixels","resizeBilinear","div","expandDims","predict","squeeze","Error","trainModel","_trainModel","_callee3","images","labels","_callee3$","_context3","abrupt","Promise","_ref","_callee2","resolve","reject","xs","ys","_callee2$","_context2","stack","map","oneHot","tensor1d","fit","epochs","shuffle","t0","dispose","finish","_x3","_x4","_x","_x2","predictImage","imageFeatures","predictionLabel","dataSync","error"],"sources":["C:/Users/vince/OneDrive/Documents/GitHub/eleusia/src/components/AIModel.tsx"],"sourcesContent":["import * as tf from '@tensorflow/tfjs';\r\n\r\nconst CLASS_NAMES = [\"Refused\", \"Accepted\"]; // Put your class names here\r\n\r\nexport type ImageElement = HTMLImageElement | HTMLCanvasElement | HTMLVideoElement | ImageData;\r\n\r\nconst MyModel = {\r\n  featureExtractor: null as tf.GraphModel | null,\r\n  model: null as tf.Sequential | null,\r\n\r\n  loadFeatureExtractor: async () => {\r\n    const URL = 'https://tfhub.dev/google/tfjs-model/imagenet/mobilenet_v3_small_100_224/feature_vector/5/default/1';\r\n    MyModel.featureExtractor = await tf.loadGraphModel(URL, {fromTFHub: true});\r\n    console.log('Feature extractor loaded');\r\n  },\r\n\r\n  loadModel: () => {\r\n    MyModel.model = tf.sequential();\r\n    MyModel.model.add(tf.layers.dense({inputShape: [1024], units: 128, activation: 'relu'}));\r\n    MyModel.model.add(tf.layers.dense({units: CLASS_NAMES.length, activation: 'softmax'}));\r\n    MyModel.model.compile({\r\n      optimizer: 'adam',\r\n      loss: CLASS_NAMES.length === 2 ? 'binaryCrossentropy' : 'categoricalCrossentropy',\r\n      metrics: ['accuracy']\r\n    });\r\n    console.log('Model loaded');\r\n  },\r\n\r\n  resetModel: () => {\r\n    MyModel.loadModel();\r\n  },\r\n\r\n  preprocessImage: (image: ImageElement) => {\r\n    return tf.tidy(() => {\r\n      let tensor = tf.browser.fromPixels(image)\r\n        .resizeBilinear([224, 224])\r\n        .div(255.0)\r\n        .expandDims();\r\n      if (MyModel.featureExtractor) {\r\n        return (MyModel.featureExtractor.predict(tensor) as tf.Tensor).squeeze();\r\n      }\r\n      throw new Error(\"Feature extractor not loaded\");\r\n    });\r\n  },\r\n\r\n  trainModel: async (images: ImageElement[], labels: number[]) => {\r\n    return new Promise<void>(async (resolve, reject) => {\r\n      let xs, ys\r\n      try {\r\n        xs = tf.stack(images.map(image => MyModel.preprocessImage(image)));\r\n        ys = tf.oneHot(tf.tensor1d(labels, 'int32'), CLASS_NAMES.length);\r\n        if (MyModel.model) {\r\n          await MyModel.model.fit(xs, ys, {\r\n            epochs: 10,\r\n            shuffle: true\r\n          });\r\n          console.log('Model trained');\r\n          resolve();\r\n        } else {\r\n          reject(new Error(\"Model not loaded\"));\r\n        }\r\n      } catch(error) {\r\n        reject(error);\r\n      } finally {\r\n        if (xs) xs.dispose();\r\n        if (ys) ys.dispose();\r\n      }\r\n    });\r\n  },\r\n\r\n  predictImage: (image: ImageElement) => {\r\n    return new Promise<Uint8Array | Float32Array | Int32Array>((resolve, reject) => {\r\n      let imageFeatures\r\n      try {\r\n        imageFeatures = MyModel.preprocessImage(image);\r\n        if (MyModel.model) {\r\n          const predictionLabel = (MyModel.model.predict(imageFeatures.expandDims()) as tf.Tensor).squeeze().dataSync();\r\n          resolve(predictionLabel);\r\n        } else {\r\n          reject(new Error(\"Model not loaded\"));\r\n        }\r\n      } catch(error) {\r\n        reject(error);\r\n      } finally {\r\n        if (imageFeatures) imageFeatures.dispose();\r\n      }\r\n    });\r\n  },\r\n};\r\n\r\nexport default MyModel;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}