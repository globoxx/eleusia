{"ast":null,"code":"import _classCallCheck from \"C:/Users/vince/OneDrive/Documents/GitHub/eleusia/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/vince/OneDrive/Documents/GitHub/eleusia/node_modules/@babel/runtime/helpers/esm/createClass.js\";\n/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nexport var DepthToSpaceProgram = /*#__PURE__*/function () {\n  function DepthToSpaceProgram(outputShape, blockSize, dataFormat) {\n    _classCallCheck(this, DepthToSpaceProgram);\n    this.variableNames = ['x'];\n    this.outputShape = [];\n    this.outputShape = outputShape;\n    this.blockSize = blockSize;\n    this.dataFormat = dataFormat;\n    this.userCode = \"\\n    void main() {\\n      ivec4 coords = getOutputCoords();\\n      int b = coords[0];\\n      int h = \".concat(this.getHeightCoordString(), \";\\n      int w = \").concat(this.getWidthCoordString(), \";\\n      int d = \").concat(this.getDepthCoordString(), \";\\n\\n      int in_h = h / \").concat(blockSize, \";\\n      int offset_h = imod(h, \").concat(blockSize, \");\\n      int in_w = w / \").concat(blockSize, \";\\n      int offset_w = imod(w, \").concat(blockSize, \");\\n      int offset_d = (offset_h * \").concat(blockSize, \" + offset_w) *\\n        \").concat(this.getOutputDepthSize(), \";\\n      int in_d = d + offset_d;\\n\\n      float result = \").concat(this.getInputSamplingString(), \";\\n      setOutput(result);\\n    }\\n  \");\n  }\n  _createClass(DepthToSpaceProgram, [{\n    key: \"getHeightCoordString\",\n    value: function getHeightCoordString() {\n      if (this.dataFormat === 'NHWC') {\n        return \"coords[1]\";\n      } else {\n        return \"coords[2]\";\n      }\n    }\n  }, {\n    key: \"getWidthCoordString\",\n    value: function getWidthCoordString() {\n      if (this.dataFormat === 'NHWC') {\n        return \"coords[2]\";\n      } else {\n        return \"coords[3]\";\n      }\n    }\n  }, {\n    key: \"getDepthCoordString\",\n    value: function getDepthCoordString() {\n      if (this.dataFormat === 'NHWC') {\n        return \"coords[3]\";\n      } else {\n        return \"coords[1]\";\n      }\n    }\n  }, {\n    key: \"getOutputDepthSize\",\n    value: function getOutputDepthSize() {\n      if (this.dataFormat === 'NHWC') {\n        return this.outputShape[3];\n      } else {\n        return this.outputShape[1];\n      }\n    }\n  }, {\n    key: \"getInputSamplingString\",\n    value: function getInputSamplingString() {\n      if (this.dataFormat === 'NHWC') {\n        return \"getX(b, in_h, in_w, in_d)\";\n      } else {\n        return \"getX(b, in_d, in_h, in_w)\";\n      }\n    }\n  }]);\n  return DepthToSpaceProgram;\n}();","map":{"version":3,"names":["DepthToSpaceProgram","outputShape","blockSize","dataFormat","_classCallCheck","variableNames","userCode","concat","getHeightCoordString","getWidthCoordString","getDepthCoordString","getOutputDepthSize","getInputSamplingString","_createClass","key","value"],"sources":["C:\\Users\\vince\\OneDrive\\Documents\\GitHub\\tfjs-backend-webgl\\src\\depth_to_space_gpu.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {GPGPUProgram} from './gpgpu_math';\n\nexport class DepthToSpaceProgram implements GPGPUProgram {\n  variableNames = ['x'];\n  outputShape: number[] = [];\n  userCode: string;\n  blockSize: number;\n  dataFormat: string;\n\n  constructor(\n      outputShape: number[], blockSize: number, dataFormat: 'NHWC'|'NCHW') {\n    this.outputShape = outputShape;\n    this.blockSize = blockSize;\n    this.dataFormat = dataFormat;\n    this.userCode = `\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${blockSize};\n      int offset_h = imod(h, ${blockSize});\n      int in_w = w / ${blockSize};\n      int offset_w = imod(w, ${blockSize});\n      int offset_d = (offset_h * ${blockSize} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `;\n  }\n\n  private getHeightCoordString(): string {\n    if (this.dataFormat === 'NHWC') {\n      return `coords[1]`;\n    } else {\n      return `coords[2]`;\n    }\n  }\n\n  private getWidthCoordString(): string {\n    if (this.dataFormat === 'NHWC') {\n      return `coords[2]`;\n    } else {\n      return `coords[3]`;\n    }\n  }\n\n  private getDepthCoordString(): string {\n    if (this.dataFormat === 'NHWC') {\n      return `coords[3]`;\n    } else {\n      return `coords[1]`;\n    }\n  }\n\n  private getOutputDepthSize(): number {\n    if (this.dataFormat === 'NHWC') {\n      return this.outputShape[3];\n    } else {\n      return this.outputShape[1];\n    }\n  }\n\n  private getInputSamplingString(): string {\n    if (this.dataFormat === 'NHWC') {\n      return `getX(b, in_h, in_w, in_d)`;\n    } else {\n      return `getX(b, in_d, in_h, in_w)`;\n    }\n  }\n}\n"],"mappings":";;AAAA;;;;;;;;;;;;;;;;AAmBA,WAAaA,mBAAmB;EAO9B,SAAAA,oBACIC,WAAqB,EAAEC,SAAiB,EAAEC,UAAyB;IAAAC,eAAA,OAAAJ,mBAAA;IAPvE,KAAAK,aAAa,GAAG,CAAC,GAAG,CAAC;IACrB,KAAAJ,WAAW,GAAa,EAAE;IAOxB,IAAI,CAACA,WAAW,GAAGA,WAAW;IAC9B,IAAI,CAACC,SAAS,GAAGA,SAAS;IAC1B,IAAI,CAACC,UAAU,GAAGA,UAAU;IAC5B,IAAI,CAACG,QAAQ,4GAAAC,MAAA,CAID,IAAI,CAACC,oBAAoB,EAAE,uBAAAD,MAAA,CAC3B,IAAI,CAACE,mBAAmB,EAAE,uBAAAF,MAAA,CAC1B,IAAI,CAACG,mBAAmB,EAAE,gCAAAH,MAAA,CAEnBL,SAAS,sCAAAK,MAAA,CACDL,SAAS,+BAAAK,MAAA,CACjBL,SAAS,sCAAAK,MAAA,CACDL,SAAS,2CAAAK,MAAA,CACLL,SAAS,8BAAAK,MAAA,CAClC,IAAI,CAACI,kBAAkB,EAAE,gEAAAJ,MAAA,CAGZ,IAAI,CAACK,sBAAsB,EAAE,2CAGjD;EACD;EAACC,YAAA,CAAAb,mBAAA;IAAAc,GAAA;IAAAC,KAAA,EAEO,SAAAP,qBAAA,EAAoB;MAC1B,IAAI,IAAI,CAACL,UAAU,KAAK,MAAM,EAAE;QAC9B;OACD,MAAM;QACL;;IAEJ;EAAC;IAAAW,GAAA;IAAAC,KAAA,EAEO,SAAAN,oBAAA,EAAmB;MACzB,IAAI,IAAI,CAACN,UAAU,KAAK,MAAM,EAAE;QAC9B;OACD,MAAM;QACL;;IAEJ;EAAC;IAAAW,GAAA;IAAAC,KAAA,EAEO,SAAAL,oBAAA,EAAmB;MACzB,IAAI,IAAI,CAACP,UAAU,KAAK,MAAM,EAAE;QAC9B;OACD,MAAM;QACL;;IAEJ;EAAC;IAAAW,GAAA;IAAAC,KAAA,EAEO,SAAAJ,mBAAA,EAAkB;MACxB,IAAI,IAAI,CAACR,UAAU,KAAK,MAAM,EAAE;QAC9B,OAAO,IAAI,CAACF,WAAW,CAAC,CAAC,CAAC;OAC3B,MAAM;QACL,OAAO,IAAI,CAACA,WAAW,CAAC,CAAC,CAAC;;IAE9B;EAAC;IAAAa,GAAA;IAAAC,KAAA,EAEO,SAAAH,uBAAA,EAAsB;MAC5B,IAAI,IAAI,CAACT,UAAU,KAAK,MAAM,EAAE;QAC9B;OACD,MAAM;QACL;;IAEJ;EAAC;EAAA,OAAAH,mBAAA;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}