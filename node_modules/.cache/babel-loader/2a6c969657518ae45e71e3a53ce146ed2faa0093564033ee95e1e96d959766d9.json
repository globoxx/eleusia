{"ast":null,"code":"/**\r\n * @license\r\n * Copyright 2020 Google LLC. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n * =============================================================================\r\n */\nimport { backend_util, util } from '@tensorflow/tfjs-core';\n/**\r\n * Template that creates implementation for binary ops. Supports broadcast.\r\n */\nexport function createSimpleBinaryKernelImpl(op) {\n  return function (aShape, bShape, aVals, bVals, dtype) {\n    var newShape = backend_util.assertAndGetBroadcastShape(aShape, bShape);\n    var resultRank = newShape.length;\n    var resultStrides = util.computeStrides(newShape);\n    var resultSize = util.sizeFromShape(newShape);\n    var result = util.getTypedArrayFromDType(dtype, resultSize);\n    var aRank = aShape.length;\n    var bRank = bShape.length;\n    var aStrides = util.computeStrides(aShape);\n    var bStrides = util.computeStrides(bShape);\n    var aBroadcastDims = backend_util.getBroadcastDims(aShape, newShape);\n    var bBroadcastDims = backend_util.getBroadcastDims(bShape, newShape);\n    if (aBroadcastDims.length + bBroadcastDims.length === 0) {\n      for (var i = 0; i < result.length; ++i) {\n        result[i] = op(aVals[i % aVals.length], bVals[i % bVals.length]);\n      }\n    } else {\n      var _loop = function _loop() {\n        var loc = util.indexToLoc(_i, resultRank, resultStrides);\n        var aLoc = loc.slice(-aRank);\n        aBroadcastDims.forEach(function (d) {\n          return aLoc[d] = 0;\n        });\n        var aIndex = util.locToIndex(aLoc, aRank, aStrides);\n        var bLoc = loc.slice(-bRank);\n        bBroadcastDims.forEach(function (d) {\n          return bLoc[d] = 0;\n        });\n        var bIndex = util.locToIndex(bLoc, bRank, bStrides);\n        result[_i] = op(aVals[aIndex], bVals[bIndex]);\n      };\n      for (var _i = 0; _i < result.length; ++_i) {\n        _loop();\n      }\n    }\n    return [result, newShape];\n  };\n}","map":{"version":3,"names":["backend_util","util","createSimpleBinaryKernelImpl","op","aShape","bShape","aVals","bVals","dtype","newShape","assertAndGetBroadcastShape","resultRank","length","resultStrides","computeStrides","resultSize","sizeFromShape","result","getTypedArrayFromDType","aRank","bRank","aStrides","bStrides","aBroadcastDims","getBroadcastDims","bBroadcastDims","i","_loop","loc","indexToLoc","aLoc","slice","forEach","d","aIndex","locToIndex","bLoc","bIndex"],"sources":["C:\\Users\\vince\\OneDrive\\Documents\\GitHub\\tfjs-backend-cpu\\src\\utils\\binary_impl.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {backend_util, DataType, DataValues, NumericDataType, TypedArray, util} from '@tensorflow/tfjs-core';\n\nimport {SimpleBinaryKernelImpl, SimpleBinaryOperation} from './binary_types';\n\n/**\n * Template that creates implementation for binary ops. Supports broadcast.\n */\nexport function createSimpleBinaryKernelImpl(op: SimpleBinaryOperation):\n    SimpleBinaryKernelImpl {\n  return (aShape: number[], bShape: number[], aVals: DataValues,\n          bVals: DataValues, dtype: DataType): [TypedArray, number[]] => {\n    const newShape = backend_util.assertAndGetBroadcastShape(aShape, bShape);\n\n    const resultRank = newShape.length;\n    const resultStrides = util.computeStrides(newShape);\n    const resultSize = util.sizeFromShape(newShape);\n\n    const result =\n        util.getTypedArrayFromDType(dtype as NumericDataType, resultSize);\n\n    const aRank = aShape.length;\n    const bRank = bShape.length;\n\n    const aStrides = util.computeStrides(aShape);\n    const bStrides = util.computeStrides(bShape);\n\n    const aBroadcastDims = backend_util.getBroadcastDims(aShape, newShape);\n    const bBroadcastDims = backend_util.getBroadcastDims(bShape, newShape);\n\n    if (aBroadcastDims.length + bBroadcastDims.length === 0) {\n      for (let i = 0; i < result.length; ++i) {\n        result[i] = op(aVals[i % aVals.length], bVals[i % bVals.length]);\n      }\n    } else {\n      for (let i = 0; i < result.length; ++i) {\n        const loc = util.indexToLoc(i, resultRank, resultStrides);\n\n        const aLoc = loc.slice(-aRank);\n        aBroadcastDims.forEach(d => aLoc[d] = 0);\n        const aIndex = util.locToIndex(aLoc, aRank, aStrides);\n\n        const bLoc = loc.slice(-bRank);\n        bBroadcastDims.forEach(d => bLoc[d] = 0);\n        const bIndex = util.locToIndex(bLoc, bRank, bStrides);\n\n        result[i] = op(aVals[aIndex], bVals[bIndex]);\n      }\n    }\n\n    return [result, newShape];\n  };\n}\n"],"mappings":"AAAA;;;;;;;;;;;;;;;;AAiBA,SAAQA,YAAY,EAAqDC,IAAI,QAAO,uBAAuB;AAI3G;;;AAGA,OAAM,SAAUC,4BAA4BA,CAACC,EAAyB;EAEpE,OAAO,UAACC,MAAgB,EAAEC,MAAgB,EAAEC,KAAiB,EACrDC,KAAiB,EAAEC,KAAe,EAA4B;IACpE,IAAMC,QAAQ,GAAGT,YAAY,CAACU,0BAA0B,CAACN,MAAM,EAAEC,MAAM,CAAC;IAExE,IAAMM,UAAU,GAAGF,QAAQ,CAACG,MAAM;IAClC,IAAMC,aAAa,GAAGZ,IAAI,CAACa,cAAc,CAACL,QAAQ,CAAC;IACnD,IAAMM,UAAU,GAAGd,IAAI,CAACe,aAAa,CAACP,QAAQ,CAAC;IAE/C,IAAMQ,MAAM,GACRhB,IAAI,CAACiB,sBAAsB,CAACV,KAAwB,EAAEO,UAAU,CAAC;IAErE,IAAMI,KAAK,GAAGf,MAAM,CAACQ,MAAM;IAC3B,IAAMQ,KAAK,GAAGf,MAAM,CAACO,MAAM;IAE3B,IAAMS,QAAQ,GAAGpB,IAAI,CAACa,cAAc,CAACV,MAAM,CAAC;IAC5C,IAAMkB,QAAQ,GAAGrB,IAAI,CAACa,cAAc,CAACT,MAAM,CAAC;IAE5C,IAAMkB,cAAc,GAAGvB,YAAY,CAACwB,gBAAgB,CAACpB,MAAM,EAAEK,QAAQ,CAAC;IACtE,IAAMgB,cAAc,GAAGzB,YAAY,CAACwB,gBAAgB,CAACnB,MAAM,EAAEI,QAAQ,CAAC;IAEtE,IAAIc,cAAc,CAACX,MAAM,GAAGa,cAAc,CAACb,MAAM,KAAK,CAAC,EAAE;MACvD,KAAK,IAAIc,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGT,MAAM,CAACL,MAAM,EAAE,EAAEc,CAAC,EAAE;QACtCT,MAAM,CAACS,CAAC,CAAC,GAAGvB,EAAE,CAACG,KAAK,CAACoB,CAAC,GAAGpB,KAAK,CAACM,MAAM,CAAC,EAAEL,KAAK,CAACmB,CAAC,GAAGnB,KAAK,CAACK,MAAM,CAAC,CAAC;;KAEnE,MAAM;MAAA,IAAAe,KAAA,YAAAA,MAAA,EACmC;QACtC,IAAMC,GAAG,GAAG3B,IAAI,CAAC4B,UAAU,CAACH,EAAC,EAAEf,UAAU,EAAEE,aAAa,CAAC;QAEzD,IAAMiB,IAAI,GAAGF,GAAG,CAACG,KAAK,CAAC,CAACZ,KAAK,CAAC;QAC9BI,cAAc,CAACS,OAAO,CAAC,UAAAC,CAAC;UAAA,OAAIH,IAAI,CAACG,CAAC,CAAC,GAAG,CAAC;QAAA,EAAC;QACxC,IAAMC,MAAM,GAAGjC,IAAI,CAACkC,UAAU,CAACL,IAAI,EAAEX,KAAK,EAAEE,QAAQ,CAAC;QAErD,IAAMe,IAAI,GAAGR,GAAG,CAACG,KAAK,CAAC,CAACX,KAAK,CAAC;QAC9BK,cAAc,CAACO,OAAO,CAAC,UAAAC,CAAC;UAAA,OAAIG,IAAI,CAACH,CAAC,CAAC,GAAG,CAAC;QAAA,EAAC;QACxC,IAAMI,MAAM,GAAGpC,IAAI,CAACkC,UAAU,CAACC,IAAI,EAAEhB,KAAK,EAAEE,QAAQ,CAAC;QAErDL,MAAM,CAACS,EAAC,CAAC,GAAGvB,EAAE,CAACG,KAAK,CAAC4B,MAAM,CAAC,EAAE3B,KAAK,CAAC8B,MAAM,CAAC,CAAC;OAC7C;MAZD,KAAK,IAAIX,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAGT,MAAM,CAACL,MAAM,EAAE,EAAEc,EAAC;QAAAC,KAAA;MAAA;;IAexC,OAAO,CAACV,MAAM,EAAER,QAAQ,CAAC;EAC3B,CAAC;AACH"},"metadata":{},"sourceType":"module","externalDependencies":[]}